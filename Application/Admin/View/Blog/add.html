<extend name="Public:main" />

<block name="style">
<style type="text/css">
#post_content, #post_textarea textarea {
	border: 1px solid #ccc;
	margin-left: 6px !important;
	background-color: #fff;
	height: 196px;
	width: 650px;
	max-width: 99%
}
#post_id,
#post_title,
#post_author,
#post_type,
#post_time,
#post_from,
#post_link {
	width: 300px;
	margin-left: 10px;
	margin-top: 6px
}
#submit {
	margin-left: 10px;
	margin-top: 6px
}
</style>
</block>

<block name="container">
<input type="text" class="form-control" id="post_id" value="Bolg-ID：{$nextID}" disabled />
<input type="text" class="form-control" id="post_title" name="post_title" placeholder="标题" />
<input type="text" class="form-control" id="post_author" name="post_author" placeholder="作者" />
<input type="text" class="form-control" id="post_type" name="post_type" placeholder="类型" />
<div id="post_content_tool">
	<div class="w-e-menu" style="z-index:101;" id="insertImg"><i class="fa fa-image" aria-hidden="true" title="添加图片(仅限标准格式)"></i></div>
	<div class="w-e-menu" style="z-index:101;" id="codeEdit"><i class="fa fa-code" aria-hidden="true" title="编辑源码"></i></div>
</div>
<div id="post_content"></div>
<div id="post_textarea">
	<textarea></textarea>
</div>
<input type="text" class="form-control" id="post_time" name="post_time" value="{$lastDate} 12:30:00">
<input type="text" class="form-control" id="post_from" name="post_from" placeholder="来源" />
<input type="text" class="form-control" id="post_link" name="post_link" placeholder="原链" />
<input type="button" class="btn btn-sm btn-success" id="submit" value="提交">
</block>

<block name="script">
<load href="{$Think.config.WUGN.CDN}/wangEditor/wangEditor.min.js" />
<script>
	laydate.render({
		elem: '#post_time',
		type: 'datetime',
		theme: 'wugn',
		calendar: true,
		today: true
	});
	
	var E = window.wangEditor
	var editor = new E('#post_content_tool', '#post_content')
	 editor.customConfig.menus = [
		'head',  // 标题
		'bold',  // 粗体
		'italic',  // 斜体
		'underline',  // 下划线
		'strikeThrough',  // 删除线
		'foreColor',  // 文字颜色
		'backColor',  // 背景颜色
		'link',  // 插入链接
		'list',  // 列表
		'justify',  // 对齐方式
		'quote',  // 引用
		'emoticon',  // 表情
		'image',  // 插入图片
		'table',  // 表格
		//'video',  // 插入视频
		'code',  // 插入代码
		'undo',  // 撤销
		'redo'  // 重复
	]
	/*editor.customConfig.onchange = function (html) {
		// html 即变化之后的内容
		console.log(html)
	}*/
	editor.customConfig.uploadImgShowBase64 = true;
	//editor.customConfig.showLinkImg = false
	editor.create()
	//editor.txt.html('<b>用js添加内容</b><br />')
	//editor.txt.append('<b>用js追加内容</b>')
</script>
<script>
$(function(){
	var imgNO = 1, isShowDiv = true,
	showTextdiv = function(){
		$("#post_content").show();
		$("#post_textarea").hide();
		editor.txt.html($("#post_textarea textarea").val());
		isShowDiv = true;
	}, showTextarea = function(){
		$("#post_content").hide();
		$("#post_textarea").show();
		$("#post_textarea textarea").val(editor.txt.html());
		isShowDiv = false;
	};
	showTextdiv();
	$("#insertImg").click(function(){
		editor.cmd.do('insertHTML', '<img src="{$Think.config.WUGN.COS}/blog/{$nextID}/' + imgNO + '.jpg" style="max-width:100%;">');
		imgNO++;
	});
	$("#codeEdit").click(function(){
		if(isShowDiv){
			showTextarea();
		}else{
			showTextdiv();
		}
	});

	$('#submit').click(function(){
		$.ajax({
			url: '__APP__/blog/insert',
			data: {
				post_title: $("#post_title").val(),
				post_author: $("#post_author").val(),
				post_type: $("#post_type").val(),
				post_content: editor.txt.html(),
				post_date: $("#post_time").val(),
				post_from: $("#post_from").val(),
				post_link: $("#post_link").val()
			},
			type: 'POST',
			cache: false,
			dataType: 'JSON',
			success: function(data) {
				if(data == '1') {
					swal({
						type: 'success',
						title: '保存成功！',
						allowEnterKey: false,
						animation: false,
						customClass: 'animated jackInTheBox',
						timer: 2000
					}).then(
						function () {
							window.location.reload();
						}
					)
				} else {
					swal({
						type: 'error',
						title: 'AJAX success, but ' + data,
						allowOutsideClick: false,
						allowEnterKey: false,
						confirmButtonText: '确认',
						animation: false,
						customClass: 'animated wobble'
					});
				}
			},
			error: function () {
				swal({
					type: 'error',
					title: 'AJAX error',
					allowOutsideClick: false,
					allowEnterKey: false,
					confirmButtonText: '确认',
					animation: false,
					customClass: 'animated wobble'
				});
			}
		});
	});
});
</script>
</block>